{% liquid
  assign on_sale = false
  assign sold_out = true
  assign option_size = product.options | size
  if product.compare_at_price > product.price
    assign on_sale = true
  endif
  if product.available
    assign sold_out = false
  endif
  assign is_size = false
  for option in product.options_with_values
    assign optionName = option.name | downcase
    if optionName contains 'size'
      assign is_size = true
    endif
  endfor
%}

<div class="card-product__item {{ slideItem }}">
  <div class="card-product__picture">
    <a class="card-product__link" href="{{ product.url | within: collection }}">
      <img width="auto" height="auto" loading="lazy" class="card-product__image" src="{{ product.featured_image.src | product_img_url: '600x' }}" alt="{{ product.featured_image.alt | escape }}">
    </a>
    {% if sold_out %}
      <div class="card-product-label card-product__sold-out">Sold out</div>
    {% endif %}
  </div>
  <div class="card-product__bottom">
    <a class="card-product__title" href="{{ product.url | within: collection }}"> {{ product.title }} </a>
    {% if is_size %}
      <div class="card-product__label"> Various sizes</div>
    {% endif %}
    <div class="card-product__price">
      {% if on_sale %}
        <span class="card-product__price--sale">{{ product.price | money }}</span>
        <span class="card-product__price--old">{{ product.compare_at_price | money }}</span>
      {% else %}
      {% if is_size %} <span class="card-product__price-text">Starting at</span>{% endif %}
        <span>{{ product.price | money }}</span>
      {% endif %}
    </div>
    <form action="/cart/add" method="post" class="card-product__form" enctype="multipart/form-data">
      <input class="card-product__variant-id" type="hidden" name="id" value="{{ product.variants[0].id }}"/>
      {% if sold_out %}
        <a href="#" class="BIS_trigger btn--disabled card-product__btn" data-product-data="{{ product | json | escape }}">
          Email when available
        </a>
      {% elsif option_size > 1 %}
        <button class="card-product__btn" data-quick-add data-url="{{ product.url }}">
          <span class="card-product__btn-icon">
            {% render 'icon-add' %}
          </span>
          <span class="card-product__btn-text"> Quick add </span>
        </button>
      {% else %}
        <button class="card-product__btn" type="submit" data-add-to-cart>
          <span class="card-product__btn-icon">
            {% render 'icon-add' %}
          </span>
          <span class="card-product__btn-text"> {{ 'products.product.add_to_cart' | t }} </span>
        </button>
      {% endif %}
    </form>
    {% if option_size > 1 %}
      <div class="quick-add"></div>
    {% endif %}
  </div>

  {% if product.metafields.global.limited_time.value  != blank %}
    <div class="card-product-label">
      {{ product.metafields.global.limited_time.value }}
    </div>
  {% endif %}
</div>
